<div class="container">
    <div class="row justify-content-center group-show-modal-invisivel">
        <div class="col-12 col-lg-6">

            <div class="group-show-modal-header">

                <% if @group.photo.attached? %>
                    <%= image_tag @group.photo, class: "group-show-image" %>
                <% else %>
                    <%= image_tag "placeholder-image.png", class: "group-show-image" %>
                <% end %>

                <h2><%= @group.name_group %></h2>
                <p><%= @group.description_group %></p>


                <div class="group-show-members-list">
                    <% @group.users.each do |user| %>
                        <% if user.photo.attached? %>
                            <%= image_tag user.photo, class: "group-show-member-photo" %>
                        <% else %>
                            <%= image_tag "placeholder-image.png", class: "group-show-member-photo" %>
                        <% end %>
                    <% end %>
                </div>

                <div class="group-show-actions">
                    <%= link_to "Editar Grupo", edit_group_path, class: "btn btn-group-show-menu" %>
                    <button id="copy-link-btn" class="btn btn-group-show-menu">Link do Grupo</button>
                    <%= link_to "Excluir", group_path(@group),
                                data: { turbo_method: :delete, turbo_confirm: "Tem certeza que deseja excluir este produto?" },
                                class: "btn btn-group-show-menu" %>
                </div>

                <div class="btns-group-show-expenses">
                    <%= link_to "Adicionar Despesa", new_group_expense_path(@group), class: "btn btn-group-show-add-expense" %>
                    <%= link_to "Adicionar Pagamento", new_group_expense_payer_path(@group), class: "btn btn-group-show-add-payment" %>
                </div>

            </div>
        </div>

        <div class="col-10 col-lg-4">


            <div class="group-show-panel" data-controller="modal">
                <div style="display: flex; align-items: center; width: 100%;" class="mb-1">
                    <h4 style="flex-grow: 1;">Painel</h4>
                    <button class="btn btn-group-show-details" data-action="click->modal#toggle">Ver detalhes</button>
                </div>
                <div class="container my-1">
                    <hr class="division-panel">
                    <div style="display: flex; align-items: center; justify-content: space-around;">
                      <div class="d-flex flex-column align-items-center">
                        <p class="text-group-show">Suas dívidas</p>
                        <p><strong>R<%= number_to_currency(@user_balance[:debit]) %></strong></p>
                      </div>
                        <span style="display: inline-block; width: 0.5px; background-color: black; height: 40px; margin: 0 15px;"></span>
                      <div class="d-flex flex-column align-items-center">
                        <p class="text-group-show">Devem a você</p>
                        <p><strong>R<%= number_to_currency(@user_balance[:credit]) %></strong></p>
                      </div>
                    </div>
                    <hr class="division-panel mb-1">
                </div>
                <div id="balance-details-modal" class="modal hidden" data-modal-target="modal">
                    <div class="modal-content">
                        <span class="close-button" data-action="click->modal#close">&times;</span>


                        <div>
                            <h5>SUAS DÍVIDAS</h5>
                            <ul>
                              <% @user_balance[:users_owing].each do |hash| %>
                                <% hash.each do |user, balance| %>
                                  <% if balance > 0 %>
                                      <li>Você deve BRL <%= number_to_currency(balance) %> para <%= user.name %></li>
                                  <% end %>
                                <% end %>
                              <% end %>
                            </ul>

                            <h5>DEVEM A VOCÊ</h5>
                            <ul>
                              <% @user_balance[:users_owed].each do |hash| %>
                                <% hash.each do |user, balance| %>
                                  <% if balance > 0 %>
                                    <li><%= user.name %> deve BRL <%= number_to_currency(balance) %> para você</li>
                                  <% end %>
                                <% end %>
                              <% end %>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <div class="group-show-expenses">
                <% if @expenses.any? %>
                    <% @expenses.group_by { |expense| expense.date.strftime("%B %Y") }.each do |month, expenses| %>
                        <h4><%= month %></h4>
                        <% expenses.each do |expense| %>

                          <%= link_to group_expense_path(@group, expense), class: "expense-link" do %>
                            <div class="group-show-expense-item">

                              <div class="group-show-number-expense">
                                <%= "#{expense.date.strftime("%d").rjust(2, "0")}" %>
                              </div>

                              <div class="group-show-name-expense">
                                <%= expense.name_expense %>
                              </div>
                            </div>
                          <% end %>

                        <% end %>

                    <% end %>

                <% else %>
                    <p>Nenhuma despesa adicionada ainda.</p>
                <% end %>
            </div>

            <div class="group-show-observations">
                <h3>Quadro</h3>
                <%= form_with model: @group, url: group_path(@group), method: :patch, local: true do |form| %>
                    <%= form.text_area :observation, placeholder: "Use o quadro para lembrar de informações importantes, como o endereço do proprietário do seu imóvel ou informações de contato de emergência.", rows: 5, class: "group-show-observation-area" %>
                    <%= form.submit "Salvar mudanças", class: "btn btn-group-show-observation" %>
                <% end %>
            </div>


            <div class="image-logo-container">
                <%= image_tag("logo.png", class: "image-logo") %>
            </div>




        </div>
    </div>
</div>
